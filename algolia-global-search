<script>
const { autocomplete, getAlgoliaResults } = window['@algolia/autocomplete-js'];
const appId = "CWUIX0EWFE";
const apiKey = "4cd4c82105f395affbc472c07a9789c8"; // Updated API key
const searchClient = algoliasearch(appId, apiKey);
const indexName = "treccy_races_all";

console.log("Initializing Algolia autocomplete..."); // Log initialization

const { setIsOpen } = autocomplete({
  container: "#global-race-search",
  placeholder: "Search this blog",
  detachedMediaQuery: '',
  openOnFocus: true,
  getSources({ query, state }) {
    console.log("Query received:", query); // Log the query

    if (!query) {
      return [];
    }

    return [
      {
        sourceId: "races",
        async getItems() { // Updated function
          console.log("Fetching results from Algolia..."); // Log fetching

          try {
            const results = await getAlgoliaResults({
              searchClient,
              queries: [
                {
                  indexName: indexName,
                  query,
                  params: {
                    attributesToSnippet: ['name:10', 'summary:35'],
                    snippetEllipsisText: 'â€¦',
                    hitsPerPage: 5
                  }
                }
              ]
            });

            console.log("Results from Algolia:", results); // Log results
            return results;
          } catch (error) {
            console.error("Error fetching results from Algolia:", error); // Log error
            return [];
          }
        },
        // Rest of the code remains the same
        // ...
      }
    ];
  }
});

console.log("Algolia autocomplete initialized."); // Log completion

document.addEventListener('keydown', (event) => {
  if (event.metaKey && event.key.toLowerCase() === 'k') {
    setIsOpen(true);
  }
});
</script>
